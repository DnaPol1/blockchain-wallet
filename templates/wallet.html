<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мой узел • Блокчейн-кошелёк</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --primary:#f2ae2e;
            --success:#10b981;
            --danger:#bf2a52;
            --bg:#f2e9ce;
            --card:#F9F2DD;
            --text:#f2ae2e;
            --border:#bfb74b;
        }
        body {
            font-family:system-ui,sans-serif;
            background:var(--bg);
            color:var(--text);
            margin:0;
            padding:20px;
            line-height:1.6;
        }
        .container {
            max-width:1000px;
            margin:0 auto;
        }
        .card {
            background:var(--card);
            border-radius:16px;
            padding:32px;
            box-shadow:0 10px 30px rgba(0,0,0,.08);
            margin-bottom:30px;}
        h1, h2 {color:var(--primary);}
        .address {
            background: var(--bg);
            padding:14px;
            border-radius:10px;
            font-family:monospace;
            word-break:break-all;
            font-size:0.95em;
        }
        .balance {
            font-size:3.2em;
            font-weight:bold;
            color:var(--primary);
            margin:20px 0;
        }
        input, button, a.button {
            padding:14px 20px;
            margin:10px 0;
            border-radius:10px;
            font-size:1.1em;
            width:100%;
            box-sizing:border-box;
        }
        input {border:1px solid var(--border);}
        button, a.button {
            background:var(--primary);
            color:white;
            text-decoration:none;
            display:inline-block;
            text-align:center;
            cursor:pointer;
            font-weight:bold;
        }
        button:hover, a.button:hover {background:#d96c80;}
        .btn-mine {background:var(--success);}
        .btn-mine:hover {background:#059669;}
        .message {
            padding:16px;
            border-radius:10px;
            margin:20px 0;
            font-weight:bold;
            font-size:1.1em;
        }
        .success {
            background:#ecfdf5;
            color:var(--success);
            border:1px solid var(--success);
        }
        .error {
            background:#fef2f2;
            color:var(--danger);
            border:1px solid var(--danger);
        }
        table {
            width:100%;
            border-collapse:collapse;
            margin-top:15px;
        }
        th, td {
            padding:14px;
            text-align:left;
            border-bottom:1px solid var(--border);
        }
        th {
            background:#f1f5f9;
            font-weight:600;
        }
        tr:hover {background:#f8fafc;}
        .section {margin-top:40px;}
        footer {
            text-align:center;
            margin-top:50px;
            color:#64748b;
            font-size:0.9em;
        }
    </style>
</head>
<body>
<div class="container">

    <div class="card">
        <h1>Мой узел • Блокчейн-кошелёк</h1>

        <p><strong>Адрес узла:</strong></p>
        <div class="address">{{ my_address }}</div>

        <div class="balance">{{ "%.2f"|format(balance) }} монет</div>

        {% if message %}
            <div class="message {{ 'success' if 'замейнён' in message or 'отправлена' in message else 'error' }}">
                {{ message }}
            </div>
        {% endif %}

        <!-- ОТПРАВКА ТРАНЗАКЦИИ -->
        <div class="section">
            <h2>Отправить транзакцию</h2>
            <form action="/wallet/send" method="POST">
                <input name="to" placeholder="Адрес получателя (04...)" required>
                <input name="amount" type="number" step="0.00000001" placeholder="Сумма" required>
                <button type="submit">Отправить в сеть</button>
            </form>
        </div>

        <!-- МАЙНИНГ -->
        <div class="section">
            <h2>Майнинг блока</h2>
            <p>Транзакций в мемпуле: <strong>{{ mempool|length }}</strong></p>
            {% if mempool|length > 0 %}
                <a href="/mine" class="button btn-mine">Замайнить новый блок (PoW)</a>
            {% else %}
                <p>Мемпул пуст — нечего майнить</p>
            {% endif %}
        </div>
    </div>

    <!-- МЕМПУЛ -->
    <div class="card section">
        <h2>Мемпул ({{ mempool|length }} неподтверждённых)</h2>
        {% if mempool %}
            <table>
                <tr><th>От кого</th><th>Кому</th><th>Сумма</th></tr>
                {% for tx in mempool %}
                    <tr>
                        <td title="{{ tx.sender }}">{{ tx.sender[:16] }}...{{ tx.sender[-8:] }}</td>
                        <td title="{{ tx.receiver }}">{{ tx.receiver[:16] }}...{{ tx.receiver[-8:] }}</td>
                        <td>{{ "%.2f"|format(tx.amount) }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Пока нет неподтверждённых транзакций</p>
        {% endif %}
    </div>

    <!-- БЛОКЧЕЙН -->
    <div class="card section">
        <h2>Блокчейн ({{ blockchain|length }} блоков)</h2>
        {% if blockchain %}
            <table>
                <tr><th>№</th><th>Хеш</th><th>Транзакций</th><th>Nonce</th><th>Время</th></tr>
                {% for b in blockchain %}
                    <tr>
                        <td>{{ b.index }}</td>
                        <td title="{{ b.hash }}"><code>{{ b.hash[:16] }}...{{ b.hash[-8:] }}</code></td>
                        <td>{{ b.transactions|length }}</td>
                        <td>{{ b.nonce }}</td>
                        <td>{{ "%.0f"|format(b.timestamp) }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Цепочка пока пуста</p>
        {% endif %}
    </div>

    <footer>Блокчейн-узел • ЮУрГУ 2025 • Полина Масалимова</footer>
</div>
</body>
</html>